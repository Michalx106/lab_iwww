<div class="task-list-header">
  <div>
    <h2>Lista zadań</h2>
    <p class="text-muted">Zadania z lokalizacją są widoczne na mapie.</p>
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-outline-success" type="button" (click)="optimizeOrder()">
      Optymalna kolejność
    </button>
    <button class="btn btn-outline-secondary" type="button" (click)="resetOrder()">
      Resetuj kolejność
    </button>
  </div>
</div>

<div class="form-check mb-3">
  <input
    class="form-check-input"
    type="checkbox"
    id="filterUndone"
    [(ngModel)]="showOnlyUndone"
    (change)="toggleFilter()"
  >
  <label class="form-check-label" for="filterUndone">Pokaż tylko niezrobione</label>
</div>

<div class="map-wrapper mb-4">
  <div #map class="task-map"></div>
</div>

<div class="alert alert-info py-2" *ngIf="statusMessage">
  {{ statusMessage }}
</div>

<ul class="list-group">
  <li class="list-group-item" *ngFor="let t of visibleTasks">
    <div class="task-details">
      <strong>{{ t.title }}</strong>
      <span class="text-muted">
        (priority: {{ t.priority }}, done: {{ t.done }})
      </span>
      <div class="text-muted small" *ngIf="t.address">
        {{ t.address }}
      </div>
      <div class="text-muted small" *ngIf="!t.address && hasLocation(t)">
        {{ t.lat }}, {{ t.lng }}
      </div>
    </div>
    <div class="task-actions">
      <button
        class="btn btn-sm btn-success"
        type="button"
        (click)="executeTask(t)"
        [disabled]="t.done || isExecuting[t.id]"
      >
        {{ t.done ? 'Wykonane' : 'Wykonaj' }}
      </button>
      <button class="btn btn-sm btn-outline-primary" (click)="showRoute(t)" [disabled]="!hasLocation(t)">
        Pokaż trasę
      </button>
    </div>
  </li>
</ul>
